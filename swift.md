# Swift

## Ecosystem
- ãƒ©ã‚¤ãƒ–ãƒ©ãƒª
  - æ¨™æº–ãƒ©ã‚¤ãƒ–ãƒ©ãƒª
  - ã‚³ã‚¢ãƒ©ã‚¤ãƒ–ãƒ©ãƒª
    - Foundation
    - libdispatch
    - XCTest
    - ..
- é–‹ç™ºãƒ„ãƒ¼ãƒ«
  - Swift Package Manager
  - LLDB

## Project Structure
- `swift package init --type executable`
```
<your-project-name>
 â”œâ”€â”€ Package.swift                          ... Manifest File
 â”œâ”€â”€ README.md
 â”œâ”€â”€ Sources
 â”‚    â””â”€â”€ <your-project-name>
 â”‚           â””â”€â”€ main.swift
 â””â”€â”€ Tests
       â”œâ”€â”€ LinuxMain.swift
       â””â”€â”€ <your-project-name>Tests
              â”œâ”€â”€ XCTestManifests.swift
              â””â”€â”€ demoTests.swift
```
- `swift build`

## å¤‰æ•°
- variables: `var totalValue:Int`
- constants: `let threshould:Int`

## å‹
- struct, class, enum:
    - common rule:
        - property/method:
            - self: instance property/method ã«ã‚¢ã‚¯ã‚»ã‚¹
            - Self: static property/method ã«ã‚¢ã‚¯ã‚»ã‚¹
        - property:
            - property observer:
                - `var ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£å = åˆæœŸå€¤ {`
                - `    willSet {`
                - `        ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã®å¤‰æ›´å‰ã«å®Ÿè¡Œã™ã‚‹æ–‡`
                - `        å¤‰æ›´å¾Œã®å€¤ã«ã¯å®šæ•°newValueã¨ã—ã¦ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹`
                - `    }`
                - `    didSet {`
                - `        ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã®å¤‰æ›´å¾Œã«å®Ÿè¡Œã™ã‚‹æ–‡`
                - `    }`
                - `}`
            - lazy stored property:
                - `static lazy var ã‚¹ã‚¿ãƒ†ã‚£ãƒƒã‚¯ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£å: ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã®å‹ = å¼`
            - computed property:
                - `var fahrenheit: Double {`
                - `    get {`
                - `        return (9.0 / 5.0) * celsius + 32.0`
                - `    }`
                - `    set {`
                - `        celsius = (5.0 / 9.0) * (newValue - 32.0)`
                - `    }`
                - `}`
        - method:
            - initializer: `init(..) { }`
            - failable initializer: `init?(..) { }`
            - subscription:
                - `struct Matrix {`
                - `    var rows: [[Int]]`
                - `    subscript(row: Int, column: Int) -> Int {`
                - `        get {`
                - `            return rows[row][column]`
                - `        }`
                - `        set {`
                - `            rows[row][column] = newValue`
                - `        }`
                - `    }`
                - `}`
                - `let matrix = Matrix(rows: [`
                - `    [1, 2, 3],`
                - `    [4, 5, 6],`
                - `    [7, 8, 9],`
                - `])`
                - `let element = matrix[1, 1] // 5`
        - extension:
    - å€¤å‹ (struct, enum):
        - struct:
            - mutating:
                - `extension Int {`
                - `    mutating func increment() {`
                - `        self += 1`
                - `    }`
                - `}`
                - `var a = 1 // 1`
                - `a.increment() // 2ï¼ˆaã«å†ä»£å…¥ãŒè¡Œã‚ã‚Œã¦ã„ã‚‹ï¼‰`
                - `let b = 1`
                - `b.increment() // bã«å†ä»£å…¥ã§ããªã„ãŸã‚ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã‚¨ãƒ©ãƒ¼`
                - struct ã® stored property ã®å¤‰æ›´ã¯å†ä»£å…¥ã‚’å¿…è¦ã¨ã™ã‚‹ãŸã‚ã€stored property ã®å¤‰æ›´ã‚’å«ã‚€ method ã«ã¯ mutating ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãŒå¿…è¦
            - memberwise initializer:
                - init ã‚’å®šç¾©ã—ãªãã¦ã‚‚è‰¯ã„
        - enum:
            - stored property ã¯æŒã¦ãªã„ (computed property ã®ã¿)
    - å‚ç…§å‹ (class):
        - class: ğŸ‘`å‚ç…§å‹ã§ç¶™æ‰¿ãŒå¯èƒ½`
            - override:
            - final: override ç¦æ­¢, class è‡ªä½“ã«ã‚‚ä»˜ä¸ã§ãã‚‹
            - class property/class method: static ã«ä¼¼ã¦ã„ã‚‹ãŒã€å­ã‚¯ãƒ©ã‚¹ã§ override ã§ãã‚‹
- protocol:
    - `protocol SomeProtocol {`
    - `    var title: String { get set }`
    - `}`
    - protocol composition:
        - `func someFunction(x: SomeProtocol1 & SomeProtocol2) {`
        - `    x.variable1 + x.variable2`
        - `}`
    - associatedtype:
    - ã‚¯ãƒ©ã‚¹å°‚ç”¨ protocol: `protocol SomeClassOnlyProtocol: class {}`
    - ä»£è¡¨çš„ãªã®:
        - Sequence
            - `forEach()`, `filter()`, `map()`, `flatMap()`, `compactMap()`, `reduce()`
        - Collection
            - `count()`, `first()`, `last()`
- Generics:
- æ±ç”¨:
    - Optional
    - ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³
        - é…åˆ—
            - Array<Element>
            - ğŸ‘\[Element]
        - è¾æ›¸
            - Dictionary<Key, Value>
            - ğŸ‘\[Key, Value]
        - ç¯„å›²
            - Range<Bound>, CountableRange<Bound>, ClosedRange<Bound>, CountableClosedRange<Bound>
                - `let range = 1..<4 // CountableRange(1..<4)`
                - `let range = 1...4 // CountableClosedRange(1...4)`
                - `for value in range {`
                - `    print(value)`
                - `}`
        - æ–‡å­—(åˆ—)
            - Character
            - String
- æ“ä½œ
    - initializer: `let a:Int = 123          let b:Int64 = Int64(a)`
    - optional:
        - æ˜ç¤ºçš„ã‚¢ãƒ³ãƒ©ãƒƒãƒ—
            - `let optionlInt: Int? = 1`
                - ğŸ‘ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ (??):
                    - `let optionalInt: Int? = nil`
                    - `let int = optionalInt ?? 3 // 3`
                - å¼·åˆ¶ã‚¢ãƒ³ãƒ©ãƒƒãƒ— (!):
                    - `let a: Int? = 1`
                    - `let b: Int? = 1`
                    - `a! + b! // 2`
                - ğŸ‘ã‚ªãƒ—ã‚·ãƒ§ãƒŠãƒ«ãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°:
                    - `let optionalDouble = Optional(1.0) // 1`
                    - `let optionalIsInfinite: Bool?`
                    - `if let double = optionalDouble {`
                    - `    optionalIsInfinite = double.isInfinite`
                    - `} else {`
                    - `    optionalIsInfinite = nil`
                    - `}`
                - ğŸ‘ã‚ªãƒ—ã‚·ãƒ§ãƒŠãƒ«ãƒã‚§ã‚¤ãƒ³ (?):
                    - `let optionalDouble = Optional(1.0) // Optional(1.0)`
                    - `let optionalIsInfinite = optionalDouble?.isInfinite`
                    - `print(String(describing: optionalIsInfinite))`
        - æš—é»™çš„ã‚¢ãƒ³ãƒ©ãƒƒãƒ—
            - `let a: Int! = 1`
            - `a + 1 // Intå‹ã¨åŒæ§˜ã«æ¼”ç®—ãŒå¯èƒ½`
            - `var b: Int! = nil`
            - `b + 1 // å€¤ãŒå…¥ã£ã¦ã„ãªã„ãŸã‚å®Ÿè¡Œæ™‚ã‚¨ãƒ©ãƒ¼`
    - Cast:
        - ã‚¢ãƒƒãƒ—ã‚­ãƒ£ã‚¹ãƒˆ:
            - ğŸ‘æ˜ç¤ºçš„ã‚¢ãƒƒãƒ—ã‚­ãƒ£ã‚¹ãƒˆ:
                - `let any = "abc" as Any`
            - æš—é»™çš„ã‚¢ãƒƒãƒ—ã‚­ãƒ£ã‚¹ãƒˆ:
                - `let any: Any = "abc"`
        - ãƒ€ã‚¦ãƒ³ã‚­ãƒ£ã‚¹ãƒˆ:
            - ğŸ‘é€šå¸¸ã®ãƒ€ã‚¦ãƒ³ã‚­ãƒ£ã‚¹ãƒˆ (?):
                - `let any = 1 as Any`
                - `let int = any as? Int // Optional(1)`
                - `let string = any as? String // nil`
            - å¼·åˆ¶çš„ãƒ€ã‚¦ãƒ³ã‚­ãƒ£ã‚¹ãƒˆ (!):
                - `let any = 1 as Any`
                - `let int = any as! Int`
                - `let string = any as! String // å®Ÿè¡Œæ™‚ã‚¨ãƒ©ãƒ¼`

## é–¢æ•°
- @
    - `@discardableResult`
- func:
    - å¼•æ•°:
        - å¯å¤‰é•·å¼•æ•°: `func print(strings: String...) {`
        - inout: `func greet(user: inout String) {`
- closure
    - ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ:
        - `{ (å¼•æ•°å1: å‹, å¼•æ•°å2: å‹...) -> æˆ»ã‚Šå€¤ã®å‹ in`
        - `    ã‚¯ãƒ­ãƒ¼ã‚¸ãƒ£ã®å®Ÿè¡Œæ™‚ã«å®Ÿè¡Œã•ã‚Œã‚‹æ–‡`
        - `    å¿…è¦ã«å¿œã˜ã¦returnæ–‡ã§æˆ»ã‚Šå€¤ã‚’è¿”å´ã™ã‚‹`
        - `}`
    - ã‚­ãƒ£ãƒ—ãƒãƒ£:
        - `let counter: () -> Int`
        - `do {`
        - `    var count = 0`
        - `    counter = {`
        - `        count += 1`
        - `        return count`
        - `    }`
        - `}`
        - `counter() // 1`
        - `counter() // 2`
    - @escaping
        - `var queue = [() -> Void]()`
        - `func enqueue(operation: @escaping () -> Void) {`
        - `    queue.append(operation)`
        - `}`
        - `enqueue { print("executed") }`
        - `enqueue { print("executed") }`
        - `queue.forEach { $0() }`
    - @autoclosure
        - `func or(_ lhs: Bool, _ rhs: @autoclosure () -> Bool) -> Boo`
            - æ­£æ ¼è©•ä¾¡
                - Swiftã§ã¯å¤šãã®ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°è¨€èªã¨åŒã˜ãã€é–¢æ•°ã®å¼•æ•°ãŒãã®é–¢æ•°ã«å¼•ãæ¸¡ã•ã‚Œã‚‹ã‚ˆã‚Šå‰ã«å®Ÿè¡Œã•ã‚Œã‚‹
                    - ã‚¯ãƒ­ãƒ¼ã‚¸ãƒ£ã‚’å¼•æ•°ã«æ¸¡ã™ã“ã¨ã§ã€é…å»¶è©•ä¾¡ãŒå¯èƒ½
                    - @autoclosure ã‚’ä½¿ãˆã°ã€å‘¼ã³å‡ºã—å´ã‚‚ç°¡æ½”ã«ãªã‚‹
    - ğŸ‘ãƒˆãƒ¬ã‚¤ãƒªãƒ³ã‚°ã‚¯ãƒ­ãƒ¼ã‚¸ãƒ£
        - `func execute(parameter: Int, handler: (String) -> Void) {`
        - `    handler("parameter is \(parameter)")`
        - `}`
        - `execute(parameter: 2) { string in`
        - `    print(string)`
        - `}`

## åˆ¶å¾¡æ–‡
- guard
    - `guard æ¡ä»¶å¼ else {`
    - `    æ¡ä»¶å¼ãŒfalseã®å ´åˆã«å®Ÿè¡Œã•ã‚Œã‚‹æ–‡`
    - `    guardæ–‡ãŒè¨˜è¿°ã•ã‚Œã¦ã„ã‚‹ã‚¹ã‚³ãƒ¼ãƒ—ã®å¤–ã«é€€å‡ºã™ã‚‹å¿…è¦ãŒã‚ã‚‹`
    - `}`
    - `guard let int = a as? Int else {`
    - `    print("aã¯Intå‹ã§ã¯ã‚ã‚Šã¾ã›ã‚“")`
    - `    return`
    - `}`
    - `// intã¯guardæ–‡ä»¥é™ã§ã‚‚ä½¿ç”¨å¯èƒ½`
    - `print("å€¤ã¯Intå‹ã®\(int)ã§ã™")`
- switch
    - `ãƒ©ãƒ™ãƒ«å: switch åˆ¶å¾¡å¼ {`
    - `case ãƒ‘ã‚¿ãƒ¼ãƒ³ where æ¡ä»¶å¼:`
    - `    åˆ¶å¾¡å¼ãŒãƒ‘ã‚¿ãƒ¼ãƒ³ã«ãƒãƒƒãƒã—ã€ã‹ã¤ã€æ¡ä»¶å¼ã‚’æº€ãŸã™å ´åˆã«å®Ÿè¡Œã•ã‚Œã‚‹æ–‡`
    - `    break ãƒ©ãƒ™ãƒ«å`
    - `    fallthrough`
    - `default:`
    - `    åˆ¶å¾¡å¼ãŒã„ãšã‚Œã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã«ã‚‚ãƒãƒƒãƒã—ãªã‹ã£ãŸå ´åˆã«å®Ÿè¡Œã•ã‚Œã‚‹æ–‡`
    - `}`
        - for ã‚‚ for ã®å‰ã«ãƒ©ãƒ™ãƒ«åã‚’ã¤ã‘ã¦ã€break æ™‚ã«æŒ‡å®šã§ãã‚‹
- defer
- ã„ã‚ã‚“ãªãƒ‘ã‚¿ãƒ¼ãƒ³ãƒãƒƒãƒ
    - if
        - `let value = 9`
        - `if case 1...10 = value {`
        - `    print("1ä»¥ä¸Š10ä»¥ä¸‹ã®å€¤ã§ã™")`
        - `}`
    - guard
        - `let value = 9`
        - `guard case 1...10 = value else {`
        - `    return`
        - `}`
    - for
        - `let array = [1, 2, 3, 4]`
        - `for case 2...3 in array {`
        - `    print("2ä»¥ä¸Š3ä»¥ä¸‹ã®å€¤ã§ã™")`
        - `}`
    - while
        - `var nextValue = Optional(1)`
        - `while case let value? = nextValue {`
        - `    print("value: \(value)")`
        - `    if value >= 3 {`
        - `        nextValue = nil`
        - `    } else {`
        - `        nextValue = value + 1`
        - `    }`
        - `}`

## å¿œç”¨
- ã‚¤ãƒ™ãƒ³ãƒˆé€šçŸ¥
    - Delegate Pattern
    - Closure
    - Observer Pattern
        - Notification / NotificationCenter
            - `import Foundation`
            - `class Poster {`
            - `    static let notificationName = Notification.Name("SomeNotification")`
            - `    func post() {`
            - `        NotificationCenter.default.post(name: Poster.notificationName, object: nil)`
            - `    }`
            - `}`
            - `class Observer {`
            - `    init() {`
            - `        NotificationCenter.default.addObserver(`
            - `            self,`
            - `            selector: #selector(handleNotification(_:)),` Objective-C ã®ã‚»ãƒ¬ã‚¯ã‚¿
            - `            name: Poster.notificationName,`
            - `            object: nil)`
            - `    }`
            - `    deinit {`
            - `        NotificationCenter.default.removeObserver(self)`
            - `    }`
            - `    @objc func handleNotification(_ notification: Notification) {`
            - `        print("é€šçŸ¥ã‚’å—ã‘å–ã‚Šã¾ã—ãŸ")`
            - `    }`
            - `}`
- éåŒæœŸå‡¦ç†
    - GCD (Closure ã‚’ä½¿ç”¨)
        - Type
            - Serial Dispatch Queue
            - Concurrent Dispatch Queue
            - `import Dispatch`
            - `\\ Main Queue` (Serial Dispatch Queue å”¯ä¸€ã²ã¨ã¤)
            - `let queue = DispatchQueue.main // ãƒ¡ã‚¤ãƒ³ãƒ‡ã‚£ã‚¹ãƒ‘ãƒƒãƒã‚­ãƒ¥ãƒ¼ã‚’å–å¾—`
            - `\\ Global Queue` (Concurrent Dispatch Queue è¤‡æ•°ã‚ã‚‹)
            - `let queue = DispatchQueue.global(qos: .userInitiated)`
            - `\\ Original Queue` (Serial, Concurrent å¥½ããªæ–¹ã‚’é¸ã¹ã‚‹)
            - `let queue = DispatchQueue(`
            - `    label: "com.my_company.my_app.upload_queue",`
            - `    qos: .default,`
            - `    attributes: [.concurrent])`
            - `queue.async {`
            - `    Thread.isMainThread // false`
            - `    print("éåŒæœŸã®å‡¦ç†")`
            - `}`
    - Operation, OperationQueue (Class ã‚’ä½¿ç”¨)
        - `import Foundation`
        - `class SomeOperation : Operation {`
        - `    let number: Int`
        - `    init(number: Int) { self.number = number }`
        - `    override func main() {`
        - `        Thread.sleep(forTimeInterval: 1)`
        - `        guard !isCancelled else { return }`
        - `        print(number)`
        - `    }`
        - `}`
        - `let queue = OperationQueue()`
        - `queue.name = "com.example.my_operation_queue"`
        - `queue.maxConcurrentOperationCount = 2`
        - `queue.qualityOfService = .userInitiated`
        - `var operations = [SomeOperation]()`
        - `for i in 0..<10 {`
        - `    operations.append(SomeOperation(number: i))`
        - `    if i > 0 {`
        - `        operations[i].addDependency(operations[i-1])`
        - `    }`
        - `}`
        - `queue.addOperations(operations, waitUntilFinished: false)`
        - `operations[6].cancel()`
    - Thread
- Error Handling
    - Optional å‹ã®åˆ©ç”¨
    - Result å‹ã®åˆ©ç”¨
