# Amazon SQS (Simple Queue Service)

- `Amazon SQS`                              フルマネージドメッセージキュー / ==デカップリング== (疎結合) / 非同期処理

## Overview

- **定義**: フルマネージドの==メッセージキュー==サービス
- **特徴**:
  - コンポーネント間の==疎結合== (デカップリング)
  - ==非同期==処理でスケーラビリティ向上
  - ==プル型== (コンシューマーがメッセージを取得)

---

## Queue タイプ (SAA 頻出)

| 項目 | ==Standard Queue== | ==FIFO Queue== |
|------|-------------------|----------------|
| **スループット** | ==無制限== | 300 msg/秒 (バッチで3000) |
| **順序** | ==ベストエフォート== (順不同の可能性) | ==厳密な順序保証== |
| **配信** | ==少なくとも1回== (重複の可能性) | ==正確に1回== |
| **ユースケース** | 高スループット優先 | 順序・重複排除が必須 |
| **キュー名** | 任意 | ==.fifo== で終わる必要あり |

---

## 重要な設定 (SAA 頻出)

| 設定 | 説明 | デフォルト |
|------|------|-----------|
| ==Visibility Timeout== | 処理中のメッセージを他から隠す時間 | 30秒 (最大12時間) |
| ==Message Retention== | メッセージ保持期間 | 4日 (最大==14日==) |
| ==Dead Letter Queue (DLQ)== | 処理失敗メッセージの退避先 | - |
| ==Long Polling== | メッセージ待機 (API コール削減) | 0秒 (Short Polling) |

### Visibility Timeout
- メッセージ受信後、他のコンシューマーから==一時的に非表示==
- タイムアウト内に処理・削除しないと==再度キューに戻る==
- 処理時間より長く設定する必要あり

### Dead Letter Queue (DLQ)
- 指定回数処理に失敗したメッセージを==別キューに退避==
- デバッグ・分析用
- ==maxReceiveCount== で失敗回数を指定

---

## 連携パターン (SAA 頻出)

### SNS + SQS (Fan-out)
```
                    +---> SQS Queue A ---> Consumer A
SNS Topic ----+---> SQS Queue B ---> Consumer B
                    +---> SQS Queue C ---> Consumer C
```
- 1つのメッセージを==複数のキューに配信==
- 各コンシューマーが独立して処理

### Lambda + SQS
- SQS をイベントソースとして Lambda を起動
- ==バッチ処理==可能 (複数メッセージを1回の呼び出しで処理)

---

## SQS vs SNS vs EventBridge

| サービス | モデル | ユースケース |
|---------|--------|-------------|
| ==SQS== | ==プル型== キュー | 非同期処理、デカップリング |
| ==SNS== | ==プッシュ型== Pub/Sub | 複数サブスクライバーへの通知 |
| ==EventBridge== | ==イベントバス== | イベント駆動、ルーティング |

---

## SAA 出題パターン

1. 「コンポーネント間を==疎結合==にしたい」
   → ==SQS==

2. 「メッセージの==順序保証==と==重複排除==が必要」
   → ==SQS FIFO==

3. 「処理失敗したメッセージを分析したい」
   → ==Dead Letter Queue (DLQ)==

4. 「1つのイベントを==複数のシステム==で処理したい」
   → ==SNS + SQS (Fan-out)==

5. 「高スループットで順序は不要」
   → ==SQS Standard==
