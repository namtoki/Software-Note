# Amazon S3 (Simple Storage Service)

```
┌─────────────────────────────────────────────────┐
│                   Amazon S3                     │
│  ┌──────────────────────────────────────────┐   │
│  │                  Bucket                  │   │
│  │  ┌──────┐  ┌──────┐  ┌──────┐  ┌──────┐  │   │
│  │  │Object│  │Object│  │Object│  │Object│  │   │
│  │  └──────┘  └──────┘  └──────┘  └──────┘  │   │
│  └──────────────────────────────────────────┘   │
└─────────────────────────────────────────────────┘
```

## Overview
- オブジェクトストレージ:             ==無制限== の容量 / オブジェクトは ==最大5TB== / 耐久性==99.999999999% (11 nines)==
  - `Bucket`:                           ==グローバルで一意== / ==リージョンに作成==
  - `Storage Classes`:
    | クラス | 可用性 | 最小保存期間 | ユースケース |
    |-------|-------|-------------|-------------|
    | `Standard` | 99.99% | なし | 頻繁にアクセス |
    | `Intelligent-Tiering` | 99.9% | なし | アクセスパターン不明 |
    | `Standard-IA` | 99.9% | 30日 | 低頻度アクセス |
    | `One Zone-IA` | 99.5% | 30日 | 低頻度 + 単一AZ (コスト最安) |
    | `Glacier Instant Retrieval` | 99.9% | 90日 | アーカイブ (ミリ秒取得) |
    | `Glacier Flexible Retrieval` | 99.99% | 90日 | アーカイブ (分〜時間) |
    | `Glacier Deep Archive` | 99.99% | 180日 | 長期アーカイブ (12時間以上) |
    - `Glacier Retrieval Options`:
      | オプション | Flexible Retrieval | Deep Archive |
      |-----------|-------------------|--------------|
      | ==Expedited== | 1〜5分 | - |
      | ==Standard== | 3〜5時間 | ==12時間== |
      | ==Bulk== | 5〜12時間 | ==48時間== |

    - `Lifecycle Policy`:
      ```
      オブジェクト作成
            ↓ 30日後
      Standard → Standard-IA
            ↓ 90日後
      Standard-IA → Glacier
            ↓ 365日後
      Glacier → 削除
      ```
      - 自動移行:                     ストレージクラス間の自動移行
      - 自動削除:                     指定日数後に削除
  - `Versioning`:                       オブジェクトの全バージョンを保持 / 削除保護 (削除しても ==Delete Marker== が付くだけ)
    - `MFA Delete`:                     ==MFA必須== で削除 (誤削除防止)

## Replication
| 種類 | 説明 |
|-----|------|
| ==CRR== (Cross-Region) | 別リージョンにレプリケート (DR, レイテンシー低減) |
| ==SRR== (Same-Region) | 同一リージョン内でレプリケート (ログ集約, 本番/テスト分離) |

- 前提:                              ==バージョニング有効== が必須 (両方のバケット)
- 既存オブジェクト:                   ==S3 Batch Replication== で対応

## Encryption
| 種類 | 説明 |
|-----|------|
| ==SSE-S3== | S3管理キー (デフォルト) |
| ==SSE-KMS== | KMS管理キー (監査ログ, キーローテーション) |
| ==SSE-C== | 顧客提供キー (顧客がキー管理) |
| ==クライアント側== | アップロード前に暗号化 |

- デフォルト暗号化:                   ==2023年以降、SSE-S3がデフォルト有効==

## Access Control
| 方法 | 説明 |
|-----|------|
| ==Bucket Policy== | バケット単位のJSON ポリシー (推奨) |
| ==ACL== | オブジェクト/バケット単位 (レガシー) |
| ==Access Points== | 大規模アクセス管理を簡素化 |
| ==Block Public Access== | パブリックアクセスを一括ブロック |

## Pre-signed URLs
- 一時的アクセス:                    ==有効期限付きURL== を生成
- 用途:                              認証なしで一時的にオブジェクトを共有

## S3 Event Notifications
```
S3 イベント (PUT, DELETE等)
      ↓
Lambda / SQS / SNS / EventBridge
```

## S3 Transfer Acceleration
- 高速転送:                          ==CloudFront Edge== 経由でアップロード高速化
- 用途:                              遠距離からの大容量アップロード

## S3 Select / Glacier Select
- クエリ:                            オブジェクト内のデータを ==SQL で抽出==
- 効果:                              全データ取得せず必要部分のみ (コスト/時間削減)

## Object Lock
| モード | 説明 |
|-------|------|
| ==Governance== | 特権ユーザーは削除/上書き可能 |
| ==Compliance== | ==誰も削除/上書き不可== (期間終了まで) |

- Legal Hold:                        期間なしでロック (訴訟保留等)

## Multipart Upload
- 推奨:                              ==100MB以上== のファイル
- 必須:                              ==5GB以上== のファイル
- 並列アップロード:                   大容量ファイルを分割して高速化

## SAA試験ポイント
| シナリオ | 解答 |
|---------|------|
| アクセスパターン不明 | ==Intelligent-Tiering== |
| 低頻度アクセス、コスト重視 | ==One Zone-IA== (耐障害性低くてOKなら) |
| 長期アーカイブ、取得に時間かかってOK | ==Glacier Deep Archive== |
| 別リージョンにDR | ==CRR== (バージョニング必須) |
| 暗号化キーの監査ログ | ==SSE-KMS== |
| 一時的にオブジェクト共有 | ==Pre-signed URL== |
| 遠距離からの高速アップロード | ==Transfer Acceleration== |
| 規制対応で削除禁止 | ==Object Lock (Compliance)== |
| 大容量ファイルアップロード | ==Multipart Upload== |
